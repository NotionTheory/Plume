!function(){"use strict";function e(e){E=e&&e.state&&e.state.roomName,E?(e=e||!0,y.roomName.value=E):"change"===e.type?E=y.roomName.value:(E=g.toString(),y.roomName.placeholder="Type a room name (currently "+E+")",y.roomName.value=""),e&&"popstate"!==e.type&&history.pushState({roomName:E},"Room ID: "+E,"?room="+E)}function o(e){b=e&&e.state&&e.state.userName,b?y.userName.value=b:"change"===e.type?b=y.userName.value:(b=g.toString(),y.userName.placeholder="Type a user name (currently "+b+")",y.userName.value="")}function n(){return y.roomName.value||E}function t(){return y.userName.value||b}function r(e,o){var n=e.match(o);return n&&n[1]}function a(e){y.loginForm.style.display="none",y.frontBuffer.focus()}function i(){y.loginForm.style.display="",y.userName.focus()}function s(e){y.errorMessage.innerHTML=e,y.errorMessage.style.display="block",i(),c(!1)}function c(e){f.forEach(function(o){return o.disabled=e}),document.body.style.cursor=e?"wait":""}function l(){y.loginForm.style.display="",y.prog.style.display="none",WebVRStandardMonitor(),L.input.VR.displays.forEach(function(e,o){var n=document.createElement("button");n.type="button",n.className="secondary",n.appendChild(document.createTextNode(e.displayName)),n.addEventListener("click",L.goFullScreen.bind(L,o,"Button")),y.controls.appendChild(n)}),L.scene.traverse(function(e){0===e.name.indexOf("LightPanel")&&e.material.emissive.setRGB(1,1,1)})}function u(e){e&&"keyup"===e.type&&e.keyCode!==Primrose.Keys.ENTER||(c(!0),k||(console.log("connecting to: %s",N),k=io(N),k.on("connect_error",m),k.on("reconnect",u),k.on("loginFailed",d),k.on("loginComplete",p),k.on("errorDetail",console.error.bind(console))),k.emit("guest",{userName:t(),appKey:n()}))}function m(e){k.close(),k=null,L.disconnect(),d("an error occured while connecting to the server.")}function d(e){s("We couldn't log you in right now because "+e.replace(/\[USER\]/g,y.userName.value))}function p(){y.errorMessage.innerHTML="",y.errorMessage.style.display="none",c(!1),a();var e=t(),o=n();document.cookie="user="+e+"&room="+o,L.connect(k,e),document.title=e+" in "+o}WebVRStandardMonitor();var y=Primrose.DOM.findEverything(),f=[y.userName,y.connect],g=NameGen.compile("!mi"),v=location.protocol.replace("http","ws"),N=v+"//"+location.hostname,h=/\broom=(\w+)/,w=/\buser=(\w+)/,E=null,b=null,k=null,L=new Primrose.BrowserEnvironment({useFog:!1,autoScaleQuality:!0,autoRescaleQuality:!1,quality:Quality.HIGH,groundTexture:0,backgroundColor:0,disableDefaultLighting:!0,sceneModel:"models/meeting/meetingroom.obj",avatarModel:"models/avatar.json",font:"fonts/helvetiker_regular.typeface.json",webRTC:"/turn"});y.closeButton.addEventListener("click",a,!1),y.userName.addEventListener("keyup",u,!1),y.connect.addEventListener("click",u,!1),y.randomRoomName.addEventListener("click",e,!1),y.randomUserName.addEventListener("click",o,!1),y.roomName.addEventListener("change",e,!1),y.userName.addEventListener("change",o,!1),window.addEventListener("popstate",e),L.addEventListener("ready",l),e({state:{roomName:r(location.search,h)||r(document.cookie,h)}}),o({state:{userName:r(location.search,w)||r(document.cookie,w)}}),"undefined"!=typeof window&&(window.app=L)}(),console.info("plume v0.0.1. see https://www.plumevr.com for more information.");